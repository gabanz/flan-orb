description: >
  Scan ports, services and vulnerabilities and upload result to external cloud storage bucket

parameters:
  format:
    type: string
    default: "html"
    description: "The format of the report: md, html, json"
  upload:
    type: string
    default: "aws"
    description: "Upload to a AWS S3 or Google Cloud GCS. Option: aws, gcp."
  bucket:
    type: string
    default: "flanscan"
    description: "GCS or AWS S3 bucket name to upload the results to."

steps:
  - run:
      environment:
        UPLOAD: <<parameters.upload>>
        BUCKET: <<parameters.bucket>>
        FORMAT: <<parameters.format>>
      name: Start scanning
      command: |
        docker run --name flan_scan \
        -e format=<<parameters.format>> \
        -e upload=<<parameters.upload>> \
        -e bucket=<<parameters.bucket>> \
        flan_scan
